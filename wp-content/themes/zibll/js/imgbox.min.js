(function(i,e){"use strict";function t(t,s,o){function a(){d(),o.exclude&&(t+=":not("+o.exclude+")");var e=s?s+" "+t:t;s=!!o.group&&s,setTimeout(function(){c(t,s)},1e3);var a=i("body");a.data("imgbox-ison-"+e)||(a.on("click",e,function(){var e=i(this);n(e,s)}),a.data("imgbox-ison-"+e,!0))}function n(e,t){var s=r(e,t);if(s.slide){i(q+" .swiper-imgbox .swiper-wrapper").html(s.slide),o.thumbs&&i(q+" .swiper-thumbsbox .swiper-wrapper").html(s.thumbs);var a=~~e.attr("imgbox-index")||0;setTimeout(function(){o.thumbs&&O.update(),I.update(),I.slideToLoop(a,10),I.autoplay.stop(),m(a,s.length),y()},10),x(e)}}function r(e,t){var s=e.data(E);if(s)return s;var o=t?i(e.parents(t)[0]):{};if(o.length){s=o.data(E);if(s&&s.node_length==l(o))return s}return u(e,o)}function l(i){return i.find(t).length}function c(e,t){t?i(t).each(function(t){var s=i(this);s.data(E)||u(s.find(e).eq(0),s)}):i(e).each(function(e){var t=i(this);t.data(E)||u(t,{})})}function u(e,s){var a={slide:"",thumbs:"",length:0};if(s.length){var n=0;s.find(t).each(function(e){0==e&&(n=0);var t=i(this);M(t)||(t.attr("imgbox-index",n),a.slide+=z(t),a.length=n+1,o.thumbs&&(a.thumbs+=k(t)),n++)}),a.node_length=l(s),s.data(E,a)}else M(e)||e.find("img").length||(a.slide=z(e),a.length=n,e.data(E,a));return a}function d(){if(!j.length){var e='<div class="swiper-imgbox"><div class="swiper-wrapper"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-left counter-con"></div></div>',t='<div class="swiper-thumbsbox"><div class="swiper-wrapper"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-center right-top"><i class="hide-but fa fa-angle-down em12"></i></div></div>',s=o.down?'<a href="javascript:;" download class="img-down toggle-radius mr6" title="下载图片"><i class="fa fa-download"></i></a>':"";o.group&&(s+=o.play?'<a href="javascript:;" class="toggle-palay toggle-radius mr6" title="播放图片"><i class="fa fa-play"></i></a>':"",o.thumbs&&(s+='<a href="javascript:;" class="toggle-thumbs toggle-radius mr6" title="查看更多图片"><i class="fa fa-th-large"></i></a>',e+=t)),s+=o.zoom?'<a href="javascript:;" class="toggle-zoom toggle-radius mr6" title="切换图片缩放"><i class="fa fa-search"></i></a>':"",s+=o.full?'<a href="javascript:;" class="hide-sm toggle-full toggle-radius mr6" title="切换全屏"><i class="fa fa-expand"></i></a>':"",s+='<a href="javascript:;" title="关闭" class="icon-close toggle-radius"><svg viewBox="0 0 1024 1024" class="icon em12"><path d="M573.44 512.128l237.888 237.696a43.328 43.328 0 0 1 0 59.712 43.392 43.392 0 0 1-59.712 0L513.728 571.84 265.856 819.712a44.672 44.672 0 0 1-61.568 0 44.672 44.672 0 0 1 0-61.568L452.16 510.272 214.208 272.448a43.328 43.328 0 0 1 0-59.648 43.392 43.392 0 0 1 59.712 0l237.952 237.76 246.272-246.272a44.672 44.672 0 0 1 61.568 0 44.672 44.672 0 0 1 0 61.568L573.44 512.128z"></path></svg></a>',i("body").append('<div class="'+F+'" id="'+S+'"><div class="modal-backdrop imgbox-bg"></div><div class="imgbox-an">'+s+"</div>"+e+"</div>"),j=i(q),g(),b()}}function m(i,e){var t=j.find(".imgbox-an .toggle-palay");e>1?t.show():t.hide();var s=e>1?'<badge class="b-black counter">'+(i+1)+"/"+e+"</badge>":"";j.find(".counter-con").html(s)}function g(){var t=q+" .swiper-imgbox",s=~~((i(e).width()+800)/310),a={};a.speed=100*s,a.zoom={maxRatio:i(e).width()<768?3:2},a.autoplay={disableOnInteraction:!1},a.grabCursor=!0,a.navigation={nextEl:t+" .swiper-button-next",prevEl:t+" .swiper-button-prev"},a.keyboard={enabled:!0,onlyInViewport:!1},a.on={slideChange:function(){m(this.realIndex,this.slides.length)}},o.thumbs&&o.group&&(p(),a.thumbs={swiper:O,autoScrollOffset:~~(s/1.6)}),R.swiper=I=new Swiper(t,a)}function p(){var i=q+" .swiper-thumbsbox",e={watchSlidesVisibility:!0};e.navigation={nextEl:i+" .swiper-button-next",prevEl:i+" .swiper-button-prev"},e.slidesPerView="auto",e.freeMode=!0,e.freeModeSticky=!0,R.thumbs_swiper=O=new Swiper(i,e)}function b(){j.data("is_on")||(_(),j.on("click",".img-close,.imgbox-bg,.imgbox-an .icon-close",C),j.on("click",".imgbox-an .toggle-thumbs,.hide-but",function(){j.toggleClass("show-thumb")}),j.on("click",".imgbox-an .img-down",function(){var e=i(this),t=j.find(".swiper-imgbox .swiper-slide-active img"),s=t.attr("data-src")||t.attr("src"),o=s.substring(s.lastIndexOf("/")+1)||s;e.attr("href",s).attr("download",o)}),j.on("click",".imgbox-an .toggle-palay",function(){var e=i(this);e.hasClass("is-play")?I.autoplay.stop():I.autoplay.start(),e.toggleClass("is-play")}),j.on("click",".imgbox-an .toggle-zoom",function(){var e=i(this);I.zoom.toggle(),e.toggleClass("is-zoom")}),j.on("click",".imgbox-an .toggle-full",function(){document.fullscreenElement?v():f()}),j.data("is_on",!0))}function f(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(),i(q+" .imgbox-an .toggle-full .fa").removeClass("fa-expand").addClass("fa-compress"),i(q+".show").addClass("full-screen")}function v(){document.fullscreenElement&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()),i(q+" .imgbox-an .toggle-full .fa").removeClass("fa-compress").addClass("fa-expand"),j.removeClass("full-screen")}function h(i){return i.replace(/(.*\/)(.*)(-\d+x\d+\.)(.*)/g,"$1$2.$4").replace(/\??x-oss-process(.*)/,"")}function w(e){var t=e.offset(),s=t.top,o=t.left,a=i(document).scrollTop(),n=e.height(),r=e.width(),l=s-a+n/2,c=o+r/2;j.attr("style","--imgbox-origin-top:"+l+"px;--imgbox-origin-left:"+c+"px;")}function x(e){i("body").addClass("imgbox-show"),w(e),j.addClass("show").removeClass("hide")}function y(){var e=i(q+" .imgbox-an .toggle-thumbs,.hide-but");o.thumbs&&e.length&&(I.slides.length>1?e.show():(j.removeClass("show-thumb"),e.hide()))}function C(){i("body").removeClass("imgbox-show"),j.addClass("hideing").removeClass("show"),v(),setTimeout(function(){j.removeClass("hideing").addClass("hide").attr("style",""),i(".toggle-palay.is-play").removeClass("is-play");try{I.zoom.out(),I.autoplay.stop()}catch(i){}i(q+" .swiper-close").css({opacity:"",transform:""})},200)}function _(){j.on("touchmove pointermove MSPointerMove",function(i){i.preventDefault?i.preventDefault():i.returnValue=!1}),j.minitouch({direction:"bottom",selector:".swiper-close",depreciation:100,onStart:!1,stop:function(i,e,t,s){var o=e.find("img").css("transform").replace(/[^0-9\-,]/g,"").split(",")[0];return o&&o>1},onIng:function(i,e,t,s){var o=(200-s)/100;o=o<1&&o,e.css("opacity",o)},inEnd:function(i,e,t,s){s<=50&&e.css({opacity:""})},onEnd:function(i,e,t,s){C(),e.css({transform:"translateY("+(s+200)+"px)"})}})}function z(i){var e=i.attr("src")||i.attr("box-img"),t=i.attr("data-src");if(!e&&!t)return"";var s=i.attr("data-full-url")||h(t||e),o=e==s?'<img src="'+s+'" class="lazyloaded">':'<img src="'+e+'" data-src="'+s+'"  class="lazyload"><div class="swiper-lazy-preloader"></div>',a='<div class="swiper-slide"><div class="swiper-close"><div class="swiper-zoom-container"><div class="absolute img-close"></div>'+o+"</div></div></div>";return a}function k(i){var e=i.attr("data-src")||i.attr("src");if(!e)return"";var t='<img data-src="'+e+'"  class="lazyload fit-cover">',s='<div class="swiper-slide">'+t+"</div>";return s}function M(i){var e=i.attr("data-src")||i.attr("src");if(!e)return!1;e=h(e);var t=i.parent("a");if(!t.length)return!1;var s=t.attr("box-img")||t.attr("href");return s=h(s),s&&(-1==s.indexOf(e)||-1==e.indexOf(s))}var F="mini-imgbox imgbox",S="mini-imgbox",E="imgbox_data",q="#"+S,j=i(q),R=e.Miniimgbox,I=R.swiper,O=R.thumbs_swiper;o.group||(o.thumbs=!1),a()}var s=function(i,e){return t(i,e,s.options)};s.options={group:!0,thumbs:!0,down:!0,play:!0,zoom:!0,full:!0,exclude:".no-imgbox,.avatar,.img-icon,.avatar-badge,.smilie-icon"},s.swiper="",s.thumbs_swiper="",e.Miniimgbox=s})(jQuery,window),tbquire(["swiper"],function(){$("link#swiper").length||$("head").append('<link type="text/css" id="swiper" rel="stylesheet" href="'+_win.uri+"/css/swiper.min.css?ver="+_win.ver+'">'),Miniimgbox.options.group="group"===_win.imgbox_type,Miniimgbox.options.thumbs=_win.imgbox_thumbs,Miniimgbox.options.down=_win.imgbox_down,Miniimgbox.options.play=_win.imgbox_play,Miniimgbox.options.zoom=_win.imgbox_zoom,Miniimgbox.options.full=_win.imgbox_full,Miniimgbox(".alone-imgbox-img,a[data-imgbox]"),Miniimgbox("img",".wp-posts-content"),Miniimgbox("img",".imgbox-container"),Miniimgbox(".box-img",".comment-content")});