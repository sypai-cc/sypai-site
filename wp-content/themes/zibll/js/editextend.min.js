(function(t){function i(){return/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}tbquire=window.tbquire||function(){},window.zib=window.zib||{},window._win=window._win||{},zib.ajax_url=zib.ajax_url||_win.ajax_url,zib.user_upload_nonce=zib.user_upload_nonce||_win.user_upload_nonce||"",zib.media=function(i){function e(t){var i={image:"image/gif,image/jpeg,image/jpg,image/png",video:"video/*",audio:"audio/",file:"*"};return i[t]}function a(){return parseInt((Math.random()+1)*Math.pow(10,4))}function n(t,i){if("undefined"==typeof FileReader)return r("当前浏览器不支持图片上传，请更换浏览器","danger");var e=new FileReader;e.readAsDataURL(t),e.onload=function(e){i.find("img").attr({alt:t.name,src:e.target.result})}}function s(i){return t("<div />").html(t.trim(i)).text()}function o(t,i,e){var a;for(e=e||["B","K","M","G","TB"];(a=e.shift())&&t>1024;)t/=1024;return("B"===a?t:t.toFixed(void 0===i?1:i))+a}function l(i){return l.onprogress=i,function(){var i=t.ajaxSettings.xhr();return i.upload&&(i.upload.onprogress=l.onprogress),i}}function d(t,i,e){var a;return function(){var n=this,s=arguments,o=function(){a=null,e||t.apply(n,s)},l=e&&!a;clearTimeout(a),a=setTimeout(o,i),l&&t.apply(n,s)}}function r(i,e,a,n){t(".notyn").length||_win.bd.append('<div class="notyn"></div>'),e=e||"success",a=a||5e3,a=a<100?1e3*a:a;var s=n?' id="'+n+'"':"",o=t('<div class="noty1"'+s+'><div class="notyf '+e+'">'+i+"</div></div>"),l=!n;n&&t("#"+n).length?(t("#"+n).find(".notyf").removeClass().addClass("notyf "+e).html(i),o=t("#"+n),l=!0):t(".notyn").append(o),l&&setTimeout(function(){c(o)},a)}function c(t){t.addClass("notyn-out"),setTimeout(function(){t.remove()},1e3)}this.file_data={},this.upload_ing={},this.new_upload=[],this.active_lists=[],this.input_lists=[],this.option=t.extend({iframe:!0,search:!0,is_upload:!1,upload_multiple:!1,upload_size:30,multiple:0,text:{}},i),this.type_names={image:"图片",video:"视频",audio:"音频",file:"附件"},this.type=this.option.type||"image",this.type_name=this.type_names[this.type],this.refresh_lists=!0,this.ajax_url=zib.ajax_url,this.upload_nonce=zib.user_upload_nonce,this.upload_action="user_upload";var u="upload_ing";return this.init=function(){this.initDOM()},this.getMy=function(){var t=this.option;if(t.is_upload){var i=t.text.upload_title||"最大支持"+t.upload_size+"M"+(t.upload_multiple>1?"，单次可上传"+t.upload_multiple+"个文件":""),a=t.search?'<div class="relative"><input class="form-control search-input" type="text" placeholder="搜索" name="search" class="form-control"><div class="abs-right muted-3-color"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"></use></svg></div></div>':"",n='<input class="upload-input" style="display: none;" '+(1!=t.upload_multiple?' multiple="multiple"':"")+' type="file" accept="'+e(this.type)+'">',s='<div class="flex0 flex ac"><i data-toggle="tooltip" title="'+i+'" class="muted-2-color mr10 fa fa-question-circle-o"></i><label style="margin: 0;">'+n+'<botton class="nowave but c-blue upload-btn" type="button"><i aria-hidden="true" class="fa fa-cloud-upload"></i>上传</botton></label></div>',o='<div class="my-header box-body"><div class="flex ac jsb">'+a+s+"</div></div>";return'<div class="mini-media-my-box">'+o+'<div class="type-'+this.type+' notop box-body mini-media-my-lists mini-scrollbar scroll-y max-vh5"></div><div class="modal-buts but-average"><a style="display: none;" class="but c-blue my-submit" href="javascript:;">确 认</a></div></div>'}},this.getInput=function(){var t=1!=this.option.multiple,i=this.option.text.input_title||"请填写"+this.type_name+"地址"+(t?"，支持批量输入，一行一个链接":"：");return'<div class="box-body input-input-box"><p>'+i+'</p><textarea autoheight="true" maxheight="200" tabindex="1" class="form-control input-input" style="min-height:84px;" placeholder="https://..."></textarea></div><div class="modal-buts but-average"><a class="but c-blue input-submit" href="javascript:;">确 认</a></div>'},this.getIframe=function(){return'<div class="box-body iframe-input-box"><p>请输入嵌入地址或者直接粘贴iframe嵌入代码：</p><textarea autoheight="true" maxheight="200" tabindex="1" class="iframe-input form-control input-textarea" style="min-height:84px;" placeholder="&lt;iframe src=&quot;https://....&quot;&gt;&lt;/iframe&gt;"></textarea></div><div class="modal-buts but-average"><a class="but c-blue iframe-submit" href="javascript:;">确认嵌入</a></div>'},this.createContent=function(){var t=this.option.text.title?'<div class="font-bold modal-title">'+this.option.text.title+"</div>":"",i=this.option.text.subtitle?'<div class="em09 mt6 muted-2-color">'+this.option.text.subtitle+"</div>":"",e=i||t?'<div class="ml20 mt20">'+t+i+"</div>":"",a="",n=this.getInput(),s=this.getMy();switch(this.type){case"image":a=s?this.createTab([{btn:"我的图片",con:s},{btn:"外链图片",con:n}]):n;break;case"video":if(s||this.option.iframe){var o=[];s&&o.push({btn:"我的视频",con:s}),o.push({btn:"外链视频",con:n}),this.option.iframe&&o.push({btn:"嵌入视频",con:this.getIframe()}),a=this.createTab(o)}else a=n}return e+a},this.initDOM=function(){if(!this.$el){var i=this;i.this_id=a();var e="mini-media-modal-"+i.this_id,n=i.createContent(),o=t(window).width()<768,l='<div class="modal flex jc fade mini-media-modal'+(o?" bottom":"")+'" id="'+e+'" tabindex="-1" role="dialog" aria-hidden="false" style="display: none;">            <div class="modal-mini full-sm modal-dialog" role="document">            <div class="modal-content"><button data-dismiss="modal" class="mr10 mt10 close"><svg class="ic-close" aria-hidden="true"><use xlink:href="#icon-close"></use></svg></button><div class="mini-media-content">'+n+"</div></div>"+(o?'<div class="touch-close"></div>':"")+"            </div>            </div>";t("body").append(l),i.$el=t("#"+e),i.$content=t("#"+e+" .mini-media-content"),i.$mylists=t("#"+e+" .mini-media-my-lists"),o&&i.$el.on("show.bs.modal",function(){t(this).minitouch({direction:"bottom",selector:".modal-dialog",start_selector:".touch-close",onEnd:function(t){i.$el.modal("hide")}})}),i.$content.on("click","a[next-paged]",function(e){e.preventDefault();var a=t(this),n=~~a.attr("next-paged");return a.prop("outerHTML",'<a><i class="loading mr10"></i>加载中</a>'),i.loadLists(n),!1}),i.$content.on("change",".upload-input",function(e){e.preventDefault();var a=this.files||e.dataTransfer.files;if(!a||!a.length)return!1;i.uploadChange(t(this),a)}),i.$content.on("input",".search-input",d(function(e){e.preventDefault(),i.searchChange(t(this))},600)),i.$content.on("click",".search-close",function(e){if(t(this).attr("disabled"))return!1;var a=i.$content.find(".search-input");a.val(""),i.searchChange(a)}),i.$mylists.on("click",".list-item:not(.upload-ing)",function(e){i.activeLists(t(this))}),i.$content.on("click",".my-submit",function(){var t=i.GetListData(i.active_lists);i.$el.trigger("select_submit").trigger("lists_submit",{data:t,ids:i.active_lists}),i.close()}),i.$content.on("click",".input-submit",function(){var t=i.$content.find(".input-input"),e=s(t.val());if(!e)return r("请输入"+i.type_name+"地址","warning");var a=i.option.multiple;e=e.split(/[(\r\n)\r\n]+/),e.forEach((t,i)=>{t||e.splice(i,1)}),a&&e.length>a&&r("最多可输入"+a+"个"+i.type_name+"地址","warning"),i.setInputVals(e),i.$el.trigger("select_submit").trigger("input_submit",{vals:e}),i.close()}),i.$content.on("click",".iframe-submit",function(){var e=i.$content.find(".iframe-input"),a=e.val(),n=t.parseHTML(a);a=t(n).attr("src")||s(a),i.setIframeVal(a),i.$el.trigger("select_submit").trigger("iframe_submit",i.iframe_data),i.close()})}},this.resetIframeVal=function(){this.setIframeVal()},this.setIframeVal=function(t,i){this.iframe_data={src:t||"",ratio:i||56},this.$content.find(".iframe-input").val(this.iframe_data.src||"")},this.resetInputVals=function(){this.setInputVals([])},this.setInputVals=function(t){var i=this.option.multiple;i>0&&t.splice(i,t.length+1),this.input_lists=t,this.$content.find(".input-input").val(t.join("\n"))},this.resetActiveLists=function(t){this.setActiveLists([])},this.setActiveLists=function(t){this.active_lists=t;var i="active",e="active-index",a=this.option.multiple,n=1==a;this.$mylists.find(".list-item."+i).removeClass(i).find("."+e).remove();for(let a in t)this.$mylists.find('.list-item[data-file-id="'+t[a]+'"]').addClass(i).append('<div class="'+e+'">'+(n?'<i class="fa fa-check em09"></i>':1+~~a)+"</div>");var s=this.$mylists.find(".list-item:not(."+i+")");a>1&&t.length>=a?s.attr("disabled",!0):s.attr("disabled",!1);var o=this.$content.find(".my-submit");t.length&&!n?o.show():o.hide(),n&&t.length&&o.click()},this.activeLists=function(t){var i=~~t.attr("data-file-id");if(i&&!t.attr("disabled")){var e=1==this.option.multiple?[]:this.active_lists,a="active-index",n=t.find("."+a);if(n.length){var s=~~n.html()-1;e.splice(s,1)}else e.push(i);this.setActiveLists(e)}},this.GetListData=function(i){t.isArray(i)||(i=[i]);var e=[];for(let t in i){var a=i[t];this.file_data[a]&&e.push(this.file_data[a])}return e},this.getSelectUrl=function(){this.active_lists},this.searchChange=function(i){var e=t.trim(i.val()),a=i.siblings(".abs-right"),n="limit-warning",s='<div class="'+n+' top">至少输入两个字符</div>',o='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"></use></svg>',l='<i class="loading em12"></i>';if(i.siblings("."+n).remove(),a.html(o),e){if(e.length<2)return void i.after(s)}else this.new_upload=[];e&&a.html(l),this.search_val=e,this.loadLists()},this.createTab=function(t,i){var e="",a="";i=i||"main";for(let n in t){let s=this.this_id+"-tab-"+i+"-"+n;e+="<li"+(0==n?' class="active"':"")+'><a href="#'+s+'" data-toggle="tab">'+t[n].btn+"</a></li>",a+='<div class="tab-pane fade'+(0==n?" in active":"")+'" id="'+s+'">'+t[n].con+"</div>"}return'<ul class="mt20 text-center list-inline tab-nav-theme">'+e+'</ul><div class="tab-content">'+a+"</div>"},this.ajax=function(i,e){i=t.extend({action:"current_user_attachments",type:this.type,paged:1},i),t.ajax({type:"POST",url:this.ajax_url,data:i,dataType:"json",error:function(t){var i="操作失败 "+t.status+" "+t.statusText+"，请刷新页面后重试";t.responseText&&t.responseText.indexOf("致命错误")>-1&&(i="网站遇到致命错误，请检查插件冲突或通过错误日志排除错误"),console.error("ajax请求错误，错误信息如下：",t),r(i,"danger")},success:function(t){var i=t.ys?t.ys:t.error?"danger":"";t.msg&&r(t.msg,i),e(t)}})},this.createList=function(t,i){var e;switch(this.type){case"image":e='<img src="'+(t.thumbnail_url||"")+'" data-full-url="'+(t.url||"")+'" alt="'+(t.title||this.type)+'">';break;case"video":var a=t.filename||t.name,n=t.fileLength?'<i class="fa fa-play-circle-o mr3"></i>'+t.fileLength:"",s=t.filesizeInBytes?'<i class=""></i>'+o(t.filesizeInBytes):"";s=s||'<i class=""></i>'+o(t.size),e='<div class="px12 flex1 flex xx padding-6 padding-h6 muted-box"><div class="px12 text-ellipsis-2"><i class="fa fa-file-video-o mr6"></i>'+a+'</div><div class="flex1 flex ab jsb muted-2-color"><span class="">'+n+'</span><span class="">'+s+"</span></div></div>"}return'<div class="'+(i?i+" ":"")+'list-item" data-file-id="'+(t.id||0)+'" data-file-type="'+this.type+'"><div class="list-box">'+e+"</div></div>"},this.createLists=function(i){var e="",a=this;return i&&t.each(i,function(t,i){e+=a.createList(i),a.file_data[i.id]=i}),e},this.loadLists=function(t,i){var e=this;if(e.$mylists&&e.$mylists.length){var a="loading-box";t=t||1;var n=e.$mylists,s='<div style="height: 140px;width: 100%;" class="flex jc loading-box"><div class="em14 opacity5"><i class="loading"></i></div></div>';i=i||{},i.paged=t,e.search_val&&(i.search=e.search_val),1==t?n.html(s):i.exclude=e.new_upload,e.ajax(i,function(s){var o="null-box",l="theme-pagination",d="";s.lists&&(d=e.createLists(s.lists)),d&&s.all_pages>t&&(d+='<div class="text-center '+l+'" all-count="'+s.all_count+'" all-pages="'+s.all_pages+'"><div class="ajax-next"><a href="" next-paged="'+(t+1)+'"><i class="fa fa-angle-right"></i>加载更多</a></div></div>');var r=n.find(".list-item").last();if(n.find("."+l+",."+o+",."+a).remove(),r.length?r.after(d):(d=d||'<div class="flex1 opacity5 flex jc '+o+'" style="height: 140px;">暂无相应内容</div>',n.html(d)),i.search){var c='<a class="search-close" href="#"><svg aria-hidden="true"><use xlink:href="#icon-close"></use></svg></a>';e.$content.find(".search-input+.abs-right").html(c)}e.refresh_lists=!1})}},this.uploadBeforeDOM=function(t){var i=this.$mylists,e=i.find(".list-item").first();i.find(".null-box").remove(),e.length?e.before(t):i.prepend(t)},this.uploadFile=function(i,e,n){function s(){delete d.upload_ing[p],f.remove(),0==Object.keys(d.upload_ing).length&&(e.data(u,!1).attr("disabled",!1),h.attr("disabled",!1),g.attr("disabled",!1))}function o(){s(),m.html("上传失败").css({background:"rgba(255, 55, 44, 0.8)",bottom:0}),n.css({"box-shadow":"0 0 2px 2px #ff372c"}),setTimeout(function(){n.remove()},2e3)}var d=this,c=new FormData,p=a();c.append("file",i,i.name),c.append("action",d.upload_action),c.append("_wpnonce",d.upload_nonce),c.append("file_type",d.type);var m=n.find(".progress-text"),f=n.find(".progress"),v=n.find(".progress .progress-bar"),h=d.$content.find(".search-input"),g=d.$content.find(".search-close");e.data(u,!0).attr("disabled",!0),h.attr("disabled",!0),g.attr("disabled",!0),m.html('<i class="loading mr6"></i><text>准备中</text>'),d.upload_ing[p]=!0,t.ajax({type:"POST",url:d.ajax_url,data:c,processData:!1,contentType:!1,dataType:"json",error:function(t){var i="操作失败 "+t.status+" "+t.statusText+"，请刷新页面后重试";t.responseText&&t.responseText.indexOf("致命错误")>-1&&(i="网站遇到致命错误，请检查插件冲突或通过错误日志排除错误"),r("上传失败："+i,"danger"),o()},xhr:l(function(t){var i=Math.round(t.loaded/t.total*100);m.find("text").html(i>=100?"处理中":i+"%"),v.css("width",i+"%")}),success:function(t){if(t.msg){var i=t.ys?t.ys:t.error?"danger":"";r(t.msg,i)}t.id?(m.html("已上传").css({background:"rgb(92, 184, 92)"}),d.file_data[t.id]=t,d.new_upload.push(t.id),setTimeout(function(){n.prop("outerHTML",d.createList(t)),s(),d.$el.trigger("upload",t)},400)):o()}})},this.uploadChange=function(i,e){var a=this,s=a.option.upload_multiple,o=1!=s,l=a.option.upload_size;if(!e[0]||i.data(u))return!1;for(var d='<div class="progress progress-striped active progress-abs-bottom"><div class="progress-bar progress-bar-success"></div></div><div class="progress-text abs-center conter-bottom">准备中...</div>',c=1,p=0;p<e.length&&(o||!(c>1));p++){if(o&&s&&c>s){r("单次最多可上传"+s+"个内容","warning");break}var m=e[p];if(-1==m.type.indexOf(a.type)&&r("文件["+m.name+"]格式错误","danger"),m.size>1024e3*l)r("文件["+m.name+"]大小超过限制，最大"+l+"M","warning");else{var f=t(a.createList(m,"upload-ing"));f.append(d),"image"===a.type&&n(m,f),a.uploadBeforeDOM(f),a.uploadFile(m,i,f),c++}}},this.open=function(){this.$el.modal("show"),this.refresh_lists&&this.loadLists()},this.close=function(){this.$el.modal("hide")},this.init(),this},t.fn.featuredEdit=function(){function i(i){function a(i){var e=c+"-box",a=c+"-btns",d=c+"-input",u='<div class="'+e+'"></div><div class="'+a+'"></div><div class="hide '+d+'"></div>';i.$el.html(u),i.$con=i.$el.find("."+e),i.$btn=i.$el.find("."+a),i.$input=i.$el.find("."+d);var p=n(i.$el);p.options&&(i.options=t.extend(i.options,p.options)),r(i),p.data&&("video"===p.type?s(p.data,i):"slide"===p.type?o(p.data,i):l(p.data,i)),i.is_init=!0}function n(t){var i=t.attr("featured-args");try{i=JSON.parse(i)}catch(t){}return t.removeAttr("featured-args"),i}function s(i,a){var n=a.data,s=n.data||{};i.pic?s.pic=i.pic:s.pic?s.pic=s.pic:"image"==n.type&&s.url?s.pic=s.url:s.pic="",n.type="video",s.url=i.url||s.url||"",n.data=s;var o=~~a.options.video_ratio,l=t('<div class="new-dplayer '+(o?" dplayer-scale-height":"")+'" video-url="'+s.url+'" video-pic="'+s.pic+'"'+(o?'  style="--scale-height:'+o+'%;"':"")+'><div class="graphic" style="padding-bottom:'+o+'%;"><div class="abs-center text-center"><i class="fa fa-play-circle fa-4x muted-3-color opacity5" aria-hidden="true"></i></div></div></div>');a.data=n,a.$con.html(l),a.$el.addClass(c+"-loaded video"),e(a,"image"),e(a,"video_pic"),get_new_dplayer(l)}function o(i,a){var n="",s=[];t.each(i,function(t,i){var e=i.url;s.push(i.id),n+='<div class="swiper-slide"><img src="'+e+'" alt="封面幻灯片"></div>'});var o='<div class="new-swiper scale-height" data-loop="true" data-autoplay="true" data-interval="2000" style="--scale-height:'+a.options.slide_ratio+'%"><div class="swiper-wrapper">'+n+'</div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="swiper-pagination"></div></div>',l={type:"slide",data:{ids:s}};a.data=l,a.$con.html(o),a.$el.addClass(c+"-loaded slide"),e(a,"video"),new_swiper()}function l(t,i){var a=t.url,n='<div class="graphic" style="padding-bottom:'+i.options.image_ratio+'%;"><img class="fit-cover" src="'+a+'" alt="图片封面"></div>',s={type:"image",data:{url:a,id:t.id||0}};i.data=s,i.$con.html(n),i.$el.addClass(c+"-loaded image"),e(i,"video")}function d(t){var i={type:"close"};t.data=i,t.$el.removeClass(c+"-loaded image slide video"),t.$con.html(""),t.media.image.resetActiveLists(),t.media.video&&t.media.video.resetActiveLists(),e(t,"video"),e(t,"image")}function r(t){var i="",e=t.options,a="btn-video",n="btn-video-pic",r="btn-image",c="btn-delete";i+='<botton type="button" class="but cir '+r+'" title="图像" data-toggle="tooltip"><i class="em09 fa fa-camera"></i></botton>',i+=e.video?'<botton type="button" class="but cir '+n+'" title="设置视频首图封面" data-toggle="tooltip"><i class="em09 fa fa-image"></i></botton>':"",i+=e.video?'<botton type="button" class="but cir '+a+'" title="视频" data-toggle="tooltip"><i class="em09 fa fa-video-camera"></i></botton>':"",i+='<botton type="button" class="but cir '+c+'" title="移除" data-toggle="tooltip"><i class="em09 fa fa-trash"></i></botton>';var u='<div class="btns-full flex jc">'+i+"</div>";t.$btn.html(u),t.media=t.media||{};var p={type:"image",is_upload:!0,upload_multiple:1,upload_size:e.image_upload_size,multiple:1,text:{input_title:"请填写图片地址：",title:"为视频设置首图封面"}},m=t.media.video_pic=new zib.media(p);if(t.$el.on("click","."+n,function(){m.open()}),m.$el.on("lists_submit upload",function(i,e){m.close();var a=e.data?e.data[0]:e;s({pic:a.url},t)}),m.$el.on("input_submit",function(i,e){s({pic:e.vals[0]},t)}),e.video){var f={type:"video",is_upload:!0,iframe:!1,upload_multiple:1,upload_size:e.video_upload_size,multiple:1},v=t.media.video=new zib.media(f);t.$el.on("click","."+a,function(){v.open()}),v.$el.on("lists_submit upload",function(i,e){v.close();var a=e.data?e.data[0]:e;s(a,t),t.data.data&&t.data.data.pic||m.open()}),v.$el.on("input_submit",function(i,e){s({url:e.vals[0]},t)})}var h={type:"image",is_upload:!0,upload_multiple:e.slide?e.image_upload_multiple:1,upload_size:e.image_upload_size,multiple:e.slide?30:1,text:{input_title:"请填写图片地址："}},g=t.media.image=new zib.media(h);t.$el.on("click","."+r,function(){g.open()}),g.$el.on("lists_submit",function(i,e){var a=e.data;a.length>1?o(a,t):l(a[0],t)}),g.$el.on("input_submit",function(i,e){l({url:e.vals[0]},t)}),t.$el.on("click","."+c,function(){d(t)})}this.$el=t(i),this.options={video:!0,slide:!0,video_ratio:46,slide_ratio:46,image_ratio:50,video_upload_size:_win.upload_video_size||30,image_upload_size:_win.upload_img_size||4,image_upload_multiple:~~_win.img_upload_multiple||6},this.data={};var c="featured";this.is_init||a(this)}function e(t,i){var e=t.media[i];e&&(e.resetActiveLists(),e.resetInputVals())}return this.each(function(){var e=t(this),a=e.data("featured_data");a||e.data("featured_data",new i(t(this)))})},tbquire(["main"],function(){t(".featured-edit").featuredEdit()});var e=tinymce.PluginManager.add;e("zib_hide",function(i,e){function a(e,a){var s={payshow:"付费阅读",vip1:"会员可查看",logged:"登录后可查看",reply:"评论后查看"},o=i.selection.getNode(),l=t.trim(i.selection.getContent())||"",d="<p></p>";if(l="<p>"+l+"</p>",n(o))d="",l=t(o).find('[contenteditable="true"]').html();else if("P"===o.nodeName){var r=t.trim(o.outerHTML);r&&(i.dom.remove(o),l=r)}i.insertContent('<div class="tinymce-hide" contenteditable="false"><p class="hide-before">[hidecontent type="'+e+'" desc="隐藏内容：'+s[e]+'"]</p><div contenteditable="true">'+l+'</div><p class="hide-after">[/hidecontent]</p></div>'+d)}function n(t){return"tinymce-hide"===t.className}var s=[{text:"评论后可查看",onclick:function(){a("reply")}},{text:"登录后可查看",onclick:function(){a("logged")}},{text:"会员可查看",onclick:function(){a("vip1")}}];mce.hide_pay&&s.push({text:"付费后可查看",onclick:function(t){a("payshow",t)}}),i.addButton("zib_hide",{text:"",icon:"preview",tooltip:"隐藏内容",type:"menubutton",stateSelector:".tinymce-hide",menu:s}),i.on("wptoolbar",function(t){n(t.element)&&i.wp&&(t.toolbar=i.wp._createToolbar(["zib_hide","dom_remove"],!0))})}),e("zib_quote",function(i,e){function a(e){var a=t.trim(i.selection.getContent())||"",s="<p></p>";a="<p>"+a+"</p>";var o=i.selection.getNode();if(n(o))s="",a=t(o).find('[contenteditable="true"]').html();else if("P"===o.nodeName){var l=t.trim(o.outerHTML);l&&(i.dom.remove(o),a=l)}i.insertContent('<div class="quote_q quote-mce '+e+'" contenteditable="false"><div contenteditable="true">'+a+"</div></div>"+s)}function n(i){return t(i).hasClass("quote_q")}i.on("init",function(){function t(){!0==!i.settings.readonly&&n.hide(),i.execCommand("mceFocus",!1)}function e(){""==i.getContent()?n.show():n.hide()}function a(){n.hide()}let n=new s;e(),tinymce.DOM.bind(n.el,"click",t),i.on("focus",t),i.on("blur",e),i.on("change",e),i.on("setContent",e),i.on("keydown",a)});let s=function(){let t=i.getElement().getAttribute("placeholder")||i.settings.placeholder||"请输入内容",e=i.settings.placeholder_attrs||{style:{position:"absolute",top:this.get_top(),left:0,color:"rgba(136, 136, 136, 0.6)",padding:"1%",width:"98%",overflow:"hidden","white-space":"pre-wrap","font-size":"16px"}},a=i.getContentAreaContainer();this.el=tinymce.DOM.add(a,i.settings.placeholder_tag||"label",e,t)};s.prototype.get_top=function(){return tinymce.DOM.$(i.getContainer()).find(".mce-top-part")[0].clientHeight+11},s.prototype.hide=function(){tinymce.DOM.setStyle(this.el,"display","none")},s.prototype.show=function(){tinymce.DOM.setStyle(this.el,"display",""),tinymce.DOM.setStyle(this.el,"top",this.get_top())},i.addButton("zib_quote",{text:"",icon:"blockquote",tooltip:"引言",type:"menubutton",menu:[{text:"灰色",onclick:function(){a("")}},{text:"红色",onclick:function(){a("qe_wzk_c-red")}},{text:"蓝色",onclick:function(){a("qe_wzk_lan")}},{text:"绿色",onclick:function(){a("qe_wzk_lv")}}]}),i.on("wptoolbar",function(t){n(t.element)&&i.wp&&(t.toolbar=i.wp._createToolbar(["zib_quote","dom_remove"],!0))})}),e("zib_img",function(e,a){function n(){l.open()}function s(t,i,e,a){var n=e?' data-edit-file-id="'+e+'"':"",s=a?' alt="'+a+'"':"",o=i?' data-full-url="'+i+'"':"";return'<p><img src="'+t+'"'+n+s+o+"></p>"}var o={type:"image",is_upload:mce.img_allow_upload,upload_multiple:~~_win.img_upload_multiple,upload_size:_win.upload_img_size||4,multiple:30},l=new zib.media(o);l.$el.on("lists_submit",function(t,i){var a=i.data,n="";for(let t in a){var o=a[t].url,d=a[t].large_url;n+=s(d,o,a[t].id,a[t].title)}e.insertContent(n+"<p></p>"),l.resetActiveLists()}),l.$el.on("upload",function(t,i){l.active_lists.push(i.id),l.setActiveLists(l.active_lists)}),l.$el.on("input_submit",function(t,i){var a=i.vals,n="";for(let t in a)n+=s(a[t]);e.insertContent(n+"<p></p>"),l.resetInputVals()}),mce.img_allow_upload&&e.on("paste",function(i){var e=(i.clipboardData||window.clipboardData).files;e[0]&&e[0].type&&-1!=e[0].type.indexOf("image")&&(l.open(),l.resetActiveLists(),l.uploadChange(t(this),e))}),e.addButton("zib_img",{text:"",icon:"image",tooltip:"图片",onclick:function(){i()||n()},onTouchEnd:function(){i()&&n()}})}),e("zib_video",function(t,e){function a(){o.open()}function n(i,e,a){var n=' data-video-url="'+i+'"';n+=' data-video-name="'+(e||i)+'"',n+=a?' data-edit-file-id="'+a+'"':"",t.insertContent('<div contenteditable="false"'+n+' class="new-dplayer post-dplayer dplayer"></div><p></p>')}var s={type:"video",is_upload:mce.video_allow_upload,iframe:mce.video_allow_iframe,upload_multiple:1,upload_size:_win.upload_video_size||30,multiple:1},o=new zib.media(s);o.$el.on("lists_submit upload",function(t,i){o.close();var e=i.data?i.data[0]:i;n(e.url,e.filename,e.id),o.resetActiveLists()}),o.$el.on("input_submit",function(t,i){n(i.vals[0]),o.resetInputVals()}),o.$el.on("iframe_submit",function(i,e){t.insertContent('<div contenteditable="false" class="wp-block-embed is-type-video mb20"><div class="iframe-absbox" style="padding-bottom:'+(e.ratio||56)+'%;"><iframe src="'+e.src+'" allowfullscreen="allowfullscreen" framespacing="0" border="0" width="100%" frameborder="no"></iframe></div></div><p></p>'),o.resetIframeVal()}),t.addButton("zib_video",{text:"",tooltip:"视频",icon:"media",onclick:function(){i()||a()},onTouchEnd:function(){i()&&a()}})})})(jQuery);